<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wesleyan University Philippines - Room Scheduling System</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <style>
        :root {
            --primary-green: #228B22;
            --dark-green: #006400;
            --light-green: #90EE90;
            --glass-bg: rgba(255, 255, 255, 0.85);
            --glass-border: rgba(223, 223, 223, 0.76);
            --glass-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            --text-dark: #0e0e0e;
            --text-muted: #6c757d;
            --white: #ffffff;
            --light-gray: #f8f9fa;
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            --success-color: #28a745;
            --error-color: #dc3545;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #ece9e6 0%, #ffffff 100%);
            color: var(--text-dark);
            line-height: 1.6;
            min-height: 100vh;
        }

        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes slideIn {
            from { transform: translateX(-100%); }
            to { transform: translateX(0); }
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Loading Screen */
        .loading {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            z-index: 9999;
            align-items: center;
            justify-content: center;
        }

        .loading.active {
            display: flex;
            animation: fadeIn 0.5s ease-out;
        }

        .spinner {
            width: 60px;
            height: 60px;
            border: 4px solid rgba(34, 139, 34, 0.2);
            border-top: 4px solid var(--primary-green);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        /* Login Screen */
        .login-container {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 2rem;
            animation: fadeIn 1s ease-out;
        }

        .login-header {
            text-align: center;
            margin-bottom: 3rem;
            animation: fadeIn 1s ease-out 0.3s both;
        }

        .login-header h1 {
            color: var(--primary-green);
            font-size: 3rem;
            margin-bottom: 0.5rem;
        }

        .login-header p {
            color: var(--text-muted);
            font-size: 1.3rem;
        }

        .auth-box {
            background: var(--glass-bg);
            backdrop-filter: blur(25px);
            border: 1px solid var(--glass-border);
            border-radius: 20px;
            padding: 2.5rem;
            width: 100%;
            max-width: 450px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            animation: fadeIn 0.8s ease-out 0.3s both;
        }

        .auth-tabs {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 2rem;
            border-bottom: 1px solid var(--glass-border);
        }

        .auth-tab {
            flex: 1;
            padding: 1rem;
            border: none;
            border-radius: 0;
            background: transparent;
            color: var(--text-muted);
            cursor: pointer;
            font-weight: 600;
            border-bottom: 3px solid transparent;
            transition: var(--transition);
        }

        .auth-tab.active {
            color: var(--primary-green);
            border-bottom-color: var(--primary-green);
            transform: translateY(-2px);
        }

        .auth-tab:hover {
            color: var(--primary-green);
            transform: translateY(-2px);
        }

        .form-group {
            margin-bottom: 1.5rem;
            animation: fadeIn 0.6s ease-out;
        }

        .form-label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: var(--text-dark);
            font-size: 0.95rem;
        }

        .form-input, .form-select, .form-textarea {
            width: 100%;
            padding: 1rem;
            border: 2px solid var(--glass-border);
            border-radius: 10px;
            background: rgba(255, 255, 255, 0.8);
            color: var(--text-dark);
            font-size: 1rem;
            transition: var(--transition);
            backdrop-filter: blur(10px);
        }

        .form-input::placeholder, .form-textarea::placeholder {
            color: var(--text-muted);
        }

        .form-input:focus, .form-select:focus, .form-textarea:focus {
            border-color: var(--primary-green);
            outline: none;
            box-shadow: 0 0 0 3px rgba(34, 139, 34, 0.1);
            transform: translateY(-2px);
            background: var(--white);
        }

        /* Buttons */
        .btn {
            padding: 1rem 2rem;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: var(--transition);
            display: inline-flex;
            align-items: center;
            gap: 0.75rem;
            text-decoration: none;
        }

        .btn:hover {
            transform: translateY(-3px) scale(1.02);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
        }

        .btn:active {
            transform: translateY(-1px);
        }

        .btn-primary {
            background: var(--primary-green);
            color: var(--white);
        }

        .btn-primary:hover {
            background: var(--dark-green);
        }

        .btn-success { 
            background: var(--success-color);
            color: white; 
        }
        .btn-success:hover {
            background: #218838;
        }
        .btn-danger { 
            background: var(--error-color);
            color: white; 
        }
        .btn-danger:hover {
            background: #c82333;
        }
        .btn-warning { 
            background: #ffc107;
            color: #000; 
        }
        .btn-warning:hover {
            background: #e0a800;
        }
        .btn-secondary { 
            background: #6c757d;
            color: white; 
        }
        .btn-secondary:hover {
            background: #5a6268;
        }
        .btn-outline { 
            background: transparent; 
            border: 2px solid var(--primary-green);
            color: var(--primary-green);
        }
        .btn-outline:hover {
            background: var(--primary-green);
            color: var(--white);
        }

        .btn-sm {
            padding: 0.75rem 1.5rem;
            font-size: 0.9rem;
        }

        .btn-block {
            width: 100%;
            justify-content: center;
        }

        /* Main App */
        .app {
            display: flex;
            min-height: 100vh;
            animation: fadeIn 0.8s ease-out;
        }

        /* Mobile Navigation */
        .mobile-nav-toggle {
            display: none;
            position: fixed;
            top: 1rem;
            left: 1rem;
            z-index: 1001;
            background: var(--primary-green);
            color: white;
            border: none;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            font-size: 1.5rem;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }

        .sidebar {
            width: 280px;
            background: var(--glass-bg);
            backdrop-filter: blur(25px);
            border-right: 1px solid var(--glass-border);
            animation: slideIn 0.6s ease-out;
            transition: var(--transition);
            z-index: 1000;
        }

        .sidebar-header {
            padding: 2rem;
            border-bottom: 1px solid var(--glass-border);
            background: var(--primary-green);
        }

        .sidebar-header h2 {
            color: var(--white);
            font-size: 1.5rem;
        }

        .sidebar-header .text-muted {
            color: rgba(255, 255, 255, 0.8) !important;
        }

        .nav-item {
            padding: 1.25rem 2rem;
            display: flex;
            align-items: center;
            gap: 1rem;
            cursor: pointer;
            transition: var(--transition);
            border-left: 4px solid transparent;
            color: var(--text-dark);
            text-decoration: none;
            border-bottom: 1px solid var(--glass-border);
            animation: fadeIn 0.6s ease-out;
        }

        .nav-item:hover {
            background: rgba(255, 255, 255, 0.3);
            border-left-color: var(--primary-green);
            transform: translateX(5px);
            color: var(--primary-green);
        }

        .nav-item.active {
            background: rgba(255, 255, 255, 0.4);
            border-left-color: var(--primary-green);
            color: var(--primary-green);
        }

        .nav-item i {
            width: 20px;
            text-align: center;
            font-size: 1.1rem;
        }

        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: transparent;
        }

        .topbar {
            padding: 1.5rem 2.5rem;
            background: var(--glass-bg);
            backdrop-filter: blur(25px);
            border-bottom: 1px solid var(--glass-border);
            display: flex;
            justify-content: space-between;
            align-items: center;
            animation: fadeIn 0.6s ease-out 0.2s both;
        }

        .content {
            padding: 2.5rem;
            flex: 1;
            overflow-y: auto;
            animation: fadeIn 0.6s ease-out 0.4s both;
        }

        /* Cards */
        .card {
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: 15px;
            padding: 2rem;
            box-shadow: var(--glass-shadow);
            margin-bottom: 2rem;
            transition: var(--transition);
            animation: fadeIn 0.6s ease-out;
            position: relative;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.15);
        }

        .card-header {
            border-bottom: 1px solid var(--glass-border);
            padding-bottom: 1.5rem;
            margin-bottom: 1.5rem;
        }

        /* Dashboard Grid */
        .dashboard-grid {
            display: grid;
            gap: 2rem;
            margin-bottom: 2rem;
        }

        .grid-2 { grid-template-columns: repeat(auto-fit, minmax(400px, 1fr)); }
        .grid-3 { grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); }
        .grid-4 { grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); }

        .stat-card {
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: 15px;
            padding: 2rem;
            text-align: center;
            border-top: 4px solid var(--primary-green);
            transition: var(--transition);
            animation: fadeIn 0.6s ease-out;
        }

        .stat-card:hover {
            transform: translateY(-5px) scale(1.02);
        }

        .stat-number {
            font-size: 3rem;
            font-weight: bold;
            color: var(--primary-green);
            margin-bottom: 0.5rem;
        }

        .stat-label {
            color: var(--text-muted);
            font-size: 1rem;
            font-weight: 600;
        }

        /* Status Badges */
        .status-badge {
            padding: 0.5rem 1.25rem;
            border-radius: 25px;
            font-size: 0.8rem;
            font-weight: 600;
            text-transform: uppercase;
            animation: fadeIn 0.4s ease-out;
        }

        .status-vacant { background: var(--success-color); color: white; }
        .status-in-use { background: var(--error-color); color: white; }
        .status-reserved { background: #ffc107; color: #000; }

        /* Action Badges */
        .action-badge {
            padding: 0.5rem 1rem;
            border-radius: 25px;
            font-size: 0.8rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            border: none;
        }

        .action-badge.edit { background: #ffc107; color: #000; }
        .action-badge.delete { background: var(--error-color); color: white; }
        .action-badge:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }

        /* Rooms Grid */
        .rooms-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 2rem;
        }

        .room-card {
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: 15px;
            padding: 1.75rem;
            border-left: 5px solid #28a745;
            transition: var(--transition);
            animation: fadeIn 0.6s ease-out;
            position: relative;
        }

        .room-card:hover {
            transform: translateY(-5px);
        }

        .room-card.vacant { border-left-color: var(--success-color); }
        .room-card.in-use { border-left-color: var(--error-color); }
        .room-card.reserved { border-left-color: #ffc107; }

        .room-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 1rem;
        }

        .room-name {
            font-size: 1.3rem;
            font-weight: 600;
            color: var(--text-dark);
        }

        .room-actions {
            display: flex;
            gap: 0.75rem;
            margin-top: 1.25rem;
            flex-wrap: wrap;
        }

        /* Subjects Grid */
        .subjects-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 2rem;
        }

        .subject-card {
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: 15px;
            padding: 1.75rem;
            border-left: 5px solid var(--primary-green);
            transition: var(--transition);
            animation: fadeIn 0.6s ease-out;
            position: relative;
        }

        .subject-card:hover {
            transform: translateY(-5px);
        }

        /* Messages */
        .message-thread {
            max-height: 400px;
            overflow-y: auto;
            border: 1px solid var(--glass-border);
            border-radius: 15px;
            padding: 1.5rem;
            background: rgba(255, 255, 255, 0.5);
            margin-bottom: 1.5rem;
            backdrop-filter: blur(10px);
        }

        .message {
            padding: 1rem 1.25rem;
            margin-bottom: 1rem;
            border-radius: 15px;
            max-width: 70%;
            word-wrap: break-word;
            animation: fadeIn 0.4s ease-out;
        }

        .message.sent {
            background: var(--primary-green);
            color: white;
            margin-left: auto;
            border-bottom-right-radius: 5px;
        }

        .message.received {
            background: rgba(255, 255, 255, 0.8);
            border: 1px solid var(--glass-border);
            border-bottom-left-radius: 5px;
        }

        .message-input {
            display: flex;
            gap: 1rem;
            margin-top: 1.5rem;
        }

        /* Modals */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(10px);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 2rem;
            animation: fadeIn 0.3s ease-out;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: var(--glass-bg);
            backdrop-filter: blur(30px);
            border: 1px solid var(--glass-border);
            border-radius: 20px;
            padding: 2.5rem;
            width: 100%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.2);
            animation: fadeIn 0.4s ease-out 0.1s both;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            padding-bottom: 1.5rem;
            border-bottom: 1px solid var(--glass-border);
        }

        .modal-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--text-dark);
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 1.75rem;
            cursor: pointer;
            color: var(--text-muted);
            padding: 0.5rem;
            transition: var(--transition);
            border-radius: 50%;
        }

        .close-btn:hover {
            color: var(--text-dark);
            background: rgba(0, 0, 0, 0.1);
            transform: rotate(90deg);
        }

        /* User Management */
        .users-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 2rem;
        }

        .user-card {
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: 15px;
            padding: 1.75rem;
            transition: var(--transition);
            animation: fadeIn 0.6s ease-out;
            position: relative;
        }

        .user-card:hover {
            transform: translateY(-5px);
        }

        /* Search Bar */
        .search-container {
            display: flex;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .search-input {
            flex: 1;
            padding: 1rem;
            border: 2px solid var(--glass-border);
            border-radius: 10px;
            background: rgba(255, 255, 255, 0.8);
            color: var(--text-dark);
            font-size: 1rem;
            transition: var(--transition);
            backdrop-filter: blur(10px);
        }

        .search-input:focus {
            border-color: var(--primary-green);
            outline: none;
            box-shadow: 0 0 0 3px rgba(34, 139, 34, 0.1);
            transform: translateY(-2px);
            background: var(--white);
        }

        /* Notification Center */
        .notification-center {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 10000;
            display: flex;
            flex-direction: column;
            gap: 10px;
            max-width: 400px;
        }

        .notification {
            padding: 1rem 1.5rem;
            border-radius: 10px;
            color: white;
            font-weight: 600;
            animation: fadeIn 0.3s ease-out;
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255,255,255,0.2);
            display: flex;
            align-items: center;
            gap: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .notification.success {
            background: rgba(40, 167, 69, 0.9);
        }

        .notification.error {
            background: rgba(220, 53, 69, 0.9);
        }

        .notification.info {
            background: rgba(34, 139, 34, 0.9);
        }

        .notification-icon {
            font-size: 1.2rem;
        }

        /* Utility Classes */
        .hidden { display: none !important; }
        .text-center { text-align: center; }
        .text-muted { color: var(--text-muted); }
        .mb-1 { margin-bottom: 0.5rem; }
        .mb-2 { margin-bottom: 1rem; }
        .mb-3 { margin-bottom: 1.5rem; }
        .mt-2 { margin-top: 1rem; }
        .mt-3 { margin-top: 1.5rem; }
        .flex { display: flex; }
        .justify-between { justify-content: space-between; }
        .items-center { align-items: center; }
        .gap-2 { gap: 1rem; }
        .gap-3 { gap: 1.5rem; }
        .w-full { width: 100%; }
        .space-y-2 > * + * { margin-top: 0.5rem; }
        .space-y-3 > * + * { margin-top: 0.75rem; }

        /* Responsive Design */
        @media (max-width: 1200px) {
            .sidebar {
                width: 250px;
            }
        }

        @media (max-width: 992px) {
            .sidebar {
                width: 220px;
            }
            
            .content {
                padding: 2rem;
            }
            
            .dashboard-grid {
                gap: 1.5rem;
            }
        }

        @media (max-width: 768px) {
            .app {
                flex-direction: column;
            }
            
            .mobile-nav-toggle {
                display: flex;
                align-items: center;
                justify-content: center;
            }
            
            .sidebar {
                position: fixed;
                height: 100%;
                transform: translateX(-100%);
                z-index: 1000;
            }
            
            .sidebar.active {
                transform: translateX(0);
            }
            
            .content {
                padding: 1.5rem;
                margin-top: 60px;
            }
            
            .dashboard-grid {
                grid-template-columns: 1fr;
            }
            
            .grid-2, .grid-3, .grid-4 {
                grid-template-columns: 1fr;
            }
            
            .topbar {
                padding: 1.25rem;
                flex-direction: column;
                gap: 1rem;
                position: fixed;
                width: 100%;
                top: 0;
                z-index: 999;
            }

            .login-container {
                padding: 1.5rem;
            }

            .auth-box {
                max-width: 100%;
                margin: 0 1rem;
                padding: 2rem;
            }

            .modal-content {
                padding: 2rem;
                margin: 1rem;
            }

            .message {
                max-width: 85%;
            }

            .rooms-grid,
            .subjects-grid,
            .users-grid {
                grid-template-columns: 1fr;
            }

            .room-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 0.5rem;
            }

            .status-badge {
                align-self: flex-start;
                margin-top: 0.5rem;
            }
        }

        @media (max-width: 480px) {
            .auth-box {
                padding: 1.5rem;
            }
            
            .card {
                padding: 1.5rem;
            }

            .login-header h1 {
                font-size: 2.5rem;
            }

            .btn {
                padding: 0.875rem 1.5rem;
                font-size: 0.9rem;
            }

            .room-actions {
                flex-direction: column;
            }

            .message-input {
                flex-direction: column;
            }
        }

        /* Scrollbar Styling */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.1);
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb {
            background: var(--primary-green);
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--dark-green);
        }
    </style>
</head>
<body>
    <div class="loading" id="loading">
        <div class="spinner"></div>
    </div>

    <div id="loginScreen">
        <div class="login-container">
            <div class="login-header">
                <h1><i class="fa fa-graduation-cap"></i> Wesleyan University Philippines</h1>
                <p>Room Scheduling System</p>
            </div>

            <div class="auth-box">
                <div class="auth-tabs">
                    <button class="auth-tab active" onclick="showAuthForm('login')">Login</button>
                    <button class="auth-tab" onclick="showAuthForm('register')">Register</button>
                </div>

                <form id="loginForm" onsubmit="handleLogin(event)">
                    <div class="form-group">
                        <label class="form-label">Email Address</label>
                        <input type="email" class="form-input" id="loginEmail" placeholder="admin@wesleyan.edu.ph" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Password</label>
                        <input type="password" class="form-input" id="loginPassword" placeholder="Enter password" required>
                    </div>
                    <button type="submit" class="btn btn-primary btn-block">
                        <i class="fa fa-sign-in"></i> Sign In
                    </button>
                </form>

                <form id="registerForm" class="hidden" onsubmit="handleRegister(event)">
                    <div class="form-group">
                        <label class="form-label">Full Name</label>
                        <input type="text" class="form-input" id="registerName" placeholder="Juan Dela Cruz" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Email Address</label>
                        <input type="email" class="form-input" id="registerEmail" placeholder="student@wesleyan.edu.ph" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Student Number</label>
                        <input type="text" class="form-input" id="registerStudentNumber" placeholder="20240001" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Contact Information</label>
                        <input type="text" class="form-input" id="registerContact" placeholder="+63 912 345 6789" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Password</label>
                        <input type="password" class="form-input" id="registerPassword" placeholder="Create password" required>
                    </div>
                    <button type="submit" class="btn btn-primary btn-block">
                        <i class="fa fa-user-plus"></i> Create Account
                    </button>
                </form>

                <div class="mt-3 text-center">
                    <p class="text-muted mb-2"><strong>Test Accounts</strong></p>
                    <div style="font-size: 0.8rem; color: var(--text-muted);">
                        <p><strong>Admin:</strong> admin@wesleyan.edu.ph / admin123</p>
                        <p><strong>Teacher:</strong> teacher@wesleyan.edu.ph / teacher123</p>
                        <p><strong>Student:</strong> student@wesleyan.edu.ph / student123</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="app" class="app hidden">
        <!-- App content will be loaded by JavaScript -->
    </div>

    <!-- Notification Center -->
    <div class="notification-center" id="notificationCenter"></div>

    <!-- Modals -->
    <div id="addRoomModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Add New Classroom</h3>
                <button class="close-btn" onclick="closeModal('addRoomModal')">×</button>
            </div>
            <form onsubmit="handleAddRoom(event)">
                <div class="form-group">
                    <label class="form-label">Room Name</label>
                    <input type="text" class="form-input" id="roomName" placeholder="e.g., Room 101" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Room Capacity</label>
                    <input type="number" class="form-input" id="roomCapacity" placeholder="e.g., 30" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Room Type</label>
                    <input type="text" class="form-input" id="roomType" placeholder="e.g., Lecture Hall, Laboratory, Computer Lab" required>
                </div>
                <div class="flex gap-2">
                    <button type="submit" class="btn btn-primary">Create Classroom</button>
                    <button type="button" class="btn btn-secondary" onclick="closeModal('addRoomModal')">Cancel</button>
                </div>
            </form>
        </div>
    </div>

    <div id="editRoomModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Edit Classroom</h3>
                <button class="close-btn" onclick="closeModal('editRoomModal')">×</button>
            </div>
            <form onsubmit="handleEditRoom(event)">
                <input type="hidden" id="editRoomId">
                <div class="form-group">
                    <label class="form-label">Room Name</label>
                    <input type="text" class="form-input" id="editRoomName" placeholder="e.g., Room 101" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Room Capacity</label>
                    <input type="number" class="form-input" id="editRoomCapacity" placeholder="e.g., 30" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Room Type</label>
                    <input type="text" class="form-input" id="editRoomType" placeholder="e.g., Lecture Hall, Laboratory, Computer Lab" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Current Subject</label>
                    <select class="form-select" id="editRoomSubject">
                        <option value="">No Subject</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Room Status</label>
                    <select class="form-select" id="editRoomStatus" required>
                        <option value="Vacant">Vacant</option>
                        <option value="In Use">In Use</option>
                        <option value="Reserved">Reserved</option>
                    </select>
                </div>
                <div class="flex gap-2">
                    <button type="submit" class="btn btn-primary">Update Classroom</button>
                    <button type="button" class="btn btn-secondary" onclick="closeModal('editRoomModal')">Cancel</button>
                </div>
            </form>
        </div>
    </div>

    <div id="addSubjectModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Add New Subject</h3>
                <button class="close-btn" onclick="closeModal('addSubjectModal')">×</button>
            </div>
            <form onsubmit="handleAddSubject(event)">
                <div class="form-group">
                    <label class="form-label">Subject Name</label>
                    <input type="text" class="form-input" id="subjectName" placeholder="e.g., Mathematics 101" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Subject Code</label>
                    <input type="text" class="form-input" id="subjectCode" placeholder="e.g., MATH101" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Units</label>
                    <input type="number" class="form-input" id="subjectUnits" placeholder="e.g., 3" step="0.5" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Schedule Day</label>
                    <select class="form-select" id="subjectDay" required>
                        <option value="Monday">Monday</option>
                        <option value="Tuesday">Tuesday</option>
                        <option value="Wednesday">Wednesday</option>
                        <option value="Thursday">Thursday</option>
                        <option value="Friday">Friday</option>
                        <option value="Saturday">Saturday</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Start Time</label>
                    <input type="time" class="form-input" id="subjectStartTime" required>
                </div>
                <div class="form-group">
                    <label class="form-label">End Time</label>
                    <input type="time" class="form-input" id="subjectEndTime" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Instructor</label>
                    <input type="text" class="form-input" id="subjectInstructor" placeholder="e.g., Dr. Maria Santos" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Room</label>
                    <select class="form-select" id="subjectRoom" required>
                        <option value="">Select Room</option>
                    </select>
                </div>
                <div class="flex gap-2">
                    <button type="submit" class="btn btn-primary">Create Subject</button>
                    <button type="button" class="btn btn-secondary" onclick="closeModal('addSubjectModal')">Cancel</button>
                </div>
            </form>
        </div>
    </div>

    <div id="editSubjectModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Edit Subject</h3>
                <button class="close-btn" onclick="closeModal('editSubjectModal')">×</button>
            </div>
            <form onsubmit="handleEditSubject(event)">
                <input type="hidden" id="editSubjectId">
                <div class="form-group">
                    <label class="form-label">Subject Name</label>
                    <input type="text" class="form-input" id="editSubjectName" placeholder="e.g., Mathematics 101" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Subject Code</label>
                    <input type="text" class="form-input" id="editSubjectCode" placeholder="e.g., MATH101" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Units</label>
                    <input type="number" class="form-input" id="editSubjectUnits" placeholder="e.g., 3" step="0.5" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Schedule Day</label>
                    <select class="form-select" id="editSubjectDay" required>
                        <option value="Monday">Monday</option>
                        <option value="Tuesday">Tuesday</option>
                        <option value="Wednesday">Wednesday</option>
                        <option value="Thursday">Thursday</option>
                        <option value="Friday">Friday</option>
                        <option value="Saturday">Saturday</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Start Time</label>
                    <input type="time" class="form-input" id="editSubjectStartTime" required>
                </div>
                <div class="form-group">
                    <label class="form-label">End Time</label>
                    <input type="time" class="form-input" id="editSubjectEndTime" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Instructor</label>
                    <input type="text" class="form-input" id="editSubjectInstructor" placeholder="e.g., Dr. Maria Santos" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Room</label>
                    <select class="form-select" id="editSubjectRoom" required>
                        <option value="">Select Room</option>
                    </select>
                </div>
                <div class="flex gap-2">
                    <button type="submit" class="btn btn-primary">Update Subject</button>
                    <button type="button" class="btn btn-secondary" onclick="closeModal('editSubjectModal')">Cancel</button>
                </div>
            </form>
        </div>
    </div>

    <div id="addAnnouncementModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Create Announcement</h3>
                <button class="close-btn" onclick="closeModal('addAnnouncementModal')">×</button>
            </div>
            <form onsubmit="handleAddAnnouncement(event)">
                <div class="form-group">
                    <label class="form-label">Announcement Title</label>
                    <input type="text" class="form-input" id="announcementTitle" placeholder="Enter title" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Announcement Content</label>
                    <textarea class="form-textarea" id="announcementContent" placeholder="Enter details..." rows="4" required></textarea>
                </div>
                <div class="flex gap-2">
                    <button type="submit" class="btn btn-primary">Post Announcement</button>
                    <button type="button" class="btn btn-secondary" onclick="closeModal('addAnnouncementModal')">Cancel</button>
                </div>
            </form>
        </div>
    </div>

    <div id="newMessageModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">New Message</h3>
                <button class="close-btn" onclick="closeModal('newMessageModal')">×</button>
            </div>
            <form onsubmit="handleNewMessage(event)">
                <div class="form-group">
                    <label class="form-label">Recipient</label>
                    <select class="form-select" id="messageRecipient" required>
                        <option value="">Select recipient</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Message</label>
                    <textarea class="form-textarea" id="messageContent" placeholder="Type your message..." rows="4" required></textarea>
                </div>
                <div class="flex gap-2">
                    <button type="submit" class="btn btn-primary">Send Message</button>
                    <button type="button" class="btn btn-secondary" onclick="closeModal('newMessageModal')">Cancel</button>
                </div>
            </form>
        </div>
    </div>

    <div id="enrollStudentModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Enroll Student in Subject</h3>
                <button class="close-btn" onclick="closeModal('enrollStudentModal')">×</button>
            </div>
            <form onsubmit="handleEnrollStudent(event)">
                <div class="form-group">
                    <label class="form-label">Student</label>
                    <select class="form-select" id="enrollStudent" required>
                        <option value="">Select student</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Subject</label>
                    <select class="form-select" id="enrollSubject" required>
                        <option value="">Select subject</option>
                    </select>
                </div>
                <div class="flex gap-2">
                    <button type="submit" class="btn btn-primary">Enroll Student</button>
                    <button type="button" class="btn btn-secondary" onclick="closeModal('enrollStudentModal')">Cancel</button>
                </div>
            </form>
        </div>
    </div>

    <div id="editUserModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Edit User</h3>
                <button class="close-btn" onclick="closeModal('editUserModal')">×</button>
            </div>
            <form onsubmit="handleEditUser(event)">
                <input type="hidden" id="editUserId">
                <div class="form-group">
                    <label class="form-label">Full Name</label>
                    <input type="text" class="form-input" id="editUserName" placeholder="Juan Dela Cruz" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Email Address</label>
                    <input type="email" class="form-input" id="editUserEmail" placeholder="student@wesleyan.edu.ph" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Student Number</label>
                    <input type="text" class="form-input" id="editUserStudentNumber" placeholder="20240001">
                </div>
                <div class="form-group">
                    <label class="form-label">Contact Information</label>
                    <input type="text" class="form-input" id="editUserContact" placeholder="+63 912 345 6789" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Role</label>
                    <select class="form-select" id="editUserRole" required>
                        <option value="student">Student</option>
                        <option value="teacher">Teacher</option>
                        <option value="admin">Admin</option>
                    </select>
                </div>
                <div class="flex gap-2">
                    <button type="submit" class="btn btn-primary">Update User</button>
                    <button type="button" class="btn btn-secondary" onclick="closeModal('editUserModal')">Cancel</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // Enhanced data initialization
        const initializeData = () => {
            const savedData = localStorage.getItem('wupSchedulingData');
            if (savedData) return JSON.parse(savedData);

            return {
                users: [
                    { id: 1, email: 'admin@wesleyan.edu.ph', password: 'admin123', name: 'System Admin', role: 'admin', studentNumber: null, contactInfo: 'admin@wesleyan.edu.ph', createdAt: new Date().toISOString() },
                    { id: 2, email: 'teacher@wesleyan.edu.ph', password: 'teacher123', name: 'Dr. Maria Santos', role: 'teacher', studentNumber: null, contactInfo: 'teacher@wesleyan.edu.ph', createdAt: new Date().toISOString() },
                    { id: 3, email: 'student@wesleyan.edu.ph', password: 'student123', name: 'Juan Dela Cruz', role: 'student', studentNumber: '20240001', contactInfo: '+63 912 345 6789', createdAt: new Date().toISOString() }
                ],
                rooms: [
                    { id: 1, name: 'Room 101', status: 'Vacant', capacity: 30, type: 'Lecture Hall', currentSubject: null, updatedAt: new Date().toISOString() },
                    { id: 2, name: 'Science Laboratory', status: 'In Use', capacity: 25, type: 'Laboratory', currentSubject: 'Biology 101', updatedAt: new Date().toISOString() },
                    { id: 3, name: 'Computer Lab A', status: 'Reserved', capacity: 20, type: 'Computer Lab', currentSubject: 'Computer Science 101', updatedAt: new Date().toISOString() }
                ],
                subjects: [
                    { id: 1, name: 'Mathematics 101', code: 'MATH101', units: 3, day: 'Monday', startTime: '08:00', endTime: '09:30', room: 'Room 101', instructor: 'Dr. Maria Santos', enrolledStudents: [3] },
                    { id: 2, name: 'Biology 101', code: 'BIO101', units: 4, day: 'Wednesday', startTime: '10:00', endTime: '12:00', room: 'Science Laboratory', instructor: 'Dr. Santos', enrolledStudents: [3] },
                    { id: 3, name: 'Computer Science 101', code: 'CS101', units: 3, day: 'Friday', startTime: '13:00', endTime: '14:30', room: 'Computer Lab A', instructor: 'Prof. Johnson', enrolledStudents: [3] }
                ],
                announcements: [
                    { id: 1, title: 'Welcome to New Semester', content: 'Classes begin on August 15, 2024. Please check your schedules.', author: 'System Admin', createdAt: new Date().toISOString() },
                    { id: 2, title: 'Room Maintenance', content: 'Room 201 will be closed for maintenance from August 20-25.', author: 'Facilities Dept', createdAt: new Date().toISOString() }
                ],
                messages: [
                    { id: 1, from: 2, to: 3, content: 'Welcome to Mathematics 101! Please prepare for our first class.', timestamp: new Date().toISOString(), read: true },
                    { id: 2, from: 3, to: 2, content: 'Thank you professor! I look forward to your class.', timestamp: new Date().toISOString(), read: true }
                ],
                enrollments: [
                    { id: 1, studentId: 3, subjectId: 1, enrolledAt: new Date().toISOString() },
                    { id: 2, studentId: 3, subjectId: 2, enrolledAt: new Date().toISOString() },
                    { id: 3, studentId: 3, subjectId: 3, enrolledAt: new Date().toISOString() }
                ]
            };
        };

        let appData = initializeData();
        let currentUser = null;
        let currentSection = 'dashboard';
        let searchQuery = '';

        // Utility functions
        const showLoading = (show) => {
            const loading = document.getElementById('loading');
            if (show) {
                loading.classList.add('active');
            } else {
                loading.classList.remove('active');
            }
        };

        const saveData = () => {
            localStorage.setItem('wupSchedulingData', JSON.stringify(appData));
        };

        const showAuthForm = (type) => {
            const loginForm = document.getElementById('loginForm');
            const registerForm = document.getElementById('registerForm');
            const tabs = document.querySelectorAll('.auth-tab');

            tabs.forEach(tab => tab.classList.remove('active'));
            
            if (type === 'login') {
                loginForm.classList.remove('hidden');
                registerForm.classList.add('hidden');
                tabs[0].classList.add('active');
            } else {
                loginForm.classList.add('hidden');
                registerForm.classList.remove('hidden');
                tabs[1].classList.add('active');
            }
        };

        const showModal = (modalId) => {
            const modal = document.getElementById(modalId);
            modal.classList.add('active');
        };

        const closeModal = (modalId) => {
            const modal = document.getElementById(modalId);
            modal.classList.remove('active');
        };

        // Enhanced notification system
        const showNotification = (message, type = 'info') => {
            const notificationCenter = document.getElementById('notificationCenter');
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            
            const icon = type === 'success' ? 'fa-check' : type === 'error' ? 'fa-times' : 'fa-info';
            
            notification.innerHTML = `
                <div class="notification-icon">
                    <i class="fa ${icon}"></i>
                </div>
                <div>${message}</div>
            `;
            
            notificationCenter.appendChild(notification);
            
            // Auto remove after 3 seconds
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.style.animation = 'fadeIn 0.3s ease-out reverse';
                    setTimeout(() => {
                        if (notification.parentNode) {
                            notificationCenter.removeChild(notification);
                        }
                    }, 300);
                }
            }, 3000);
        };

        // Mobile navigation toggle
        const toggleMobileNav = () => {
            const sidebar = document.querySelector('.sidebar');
            sidebar.classList.toggle('active');
        };

        // Authentication handlers
        const handleLogin = (event) => {
            event.preventDefault();
            showLoading(true);

            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;

            setTimeout(() => {
                const user = appData.users.find(u => u.email === email && u.password === password);
                
                if (user) {
                    currentUser = user;
                    localStorage.setItem('currentUser', JSON.stringify(user));
                    document.getElementById('loginScreen').classList.add('hidden');
                    document.getElementById('app').classList.remove('hidden');
                    loadApp();
                    showNotification('Login successful!', 'success');
                } else {
                    showNotification('Invalid email or password', 'error');
                }
                showLoading(false);
            }, 1000);
        };

        const handleRegister = (event) => {
            event.preventDefault();
            showLoading(true);

            const name = document.getElementById('registerName').value;
            const email = document.getElementById('registerEmail').value;
            const studentNumber = document.getElementById('registerStudentNumber').value;
            const contact = document.getElementById('registerContact').value;
            const password = document.getElementById('registerPassword').value;

            setTimeout(() => {
                const existingUser = appData.users.find(u => u.email === email);
                if (existingUser) {
                    showNotification('Email already registered', 'error');
                    showLoading(false);
                    return;
                }

                const newUser = {
                    id: Math.max(...appData.users.map(u => u.id)) + 1,
                    email,
                    password,
                    name,
                    role: 'student',
                    studentNumber,
                    contactInfo: contact,
                    createdAt: new Date().toISOString()
                };

                appData.users.push(newUser);
                saveData();
                showNotification('Registration successful! Please login.', 'success');
                showAuthForm('login');
                showLoading(false);
            }, 1000);
        };

        // App navigation and content loading
        const loadApp = () => {
            const app = document.getElementById('app');
            
            // Determine if user is student to customize navigation
            const isStudent = currentUser.role === 'student';
            
            app.innerHTML = `
                <button class="mobile-nav-toggle" onclick="toggleMobileNav()">
                    <i class="fa fa-bars"></i>
                </button>
                <div class="sidebar">
                    <div class="sidebar-header">
                        <h2><i class="fa fa-graduation-cap"></i> WUP</h2>
                        <p class="text-muted">Room Scheduling System</p>
                    </div>
                    ${!isStudent ? `
                    <div class="nav-item active" onclick="navigateTo('dashboard')">
                        <i class="fa fa-dashboard"></i> Dashboard
                    </div>
                    ` : ''}
                    <div class="nav-item" onclick="navigateTo('rooms')">
                        <i class="fa fa-building"></i> Classrooms
                    </div>
                    <div class="nav-item" onclick="navigateTo('subjects')">
                        <i class="fa fa-book"></i> Subjects
                    </div>
                    <div class="nav-item" onclick="navigateTo('announcements')">
                        <i class="fa fa-bullhorn"></i> Announcements
                    </div>
                    <div class="nav-item" onclick="navigateTo('messages')">
                        <i class="fa fa-envelope"></i> Messages
                    </div>
                    ${currentUser.role === 'admin' ? `
                    <div class="nav-item" onclick="navigateTo('users')">
                        <i class="fa fa-users"></i> User Management
                    </div>
                    ` : ''}
                    <div class="nav-item" onclick="logout()" style="margin-top: auto; border-bottom: none;">
                        <i class="fa fa-sign-out"></i> Logout
                    </div>
                </div>
                <div class="main-content">
                    <div class="topbar">
                        <h2 id="pageTitle">${isStudent ? 'My Subjects' : 'Dashboard'}</h2>
                        <div class="flex items-center gap-2">
                            <span class="text-muted">Welcome, ${currentUser.name}</span>
                            <div class="status-badge" style="background: ${currentUser.role === 'admin' ? '#dc3545' : currentUser.role === 'teacher' ? '#ffc107' : '#28a745'}; color: ${currentUser.role === 'teacher' ? '#000' : 'white'};">${currentUser.role}</div>
                        </div>
                    </div>
                    <div class="content" id="contentArea">
                        <!-- Content will be loaded here -->
                    </div>
                </div>
            `;

            // Set initial section based on user role
            currentSection = isStudent ? 'subjects' : 'dashboard';
            loadSection(currentSection);
        };

        const navigateTo = (section) => {
            // Update active nav item
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            event.currentTarget.classList.add('active');

            // Update page title
            const titles = {
                dashboard: 'Dashboard',
                rooms: 'Classroom Management',
                subjects: currentUser.role === 'student' ? 'My Subjects' : 'Subject Management',
                announcements: 'Announcements',
                messages: 'Messages',
                users: 'User Management'
            };
            document.getElementById('pageTitle').textContent = titles[section];

            currentSection = section;
            loadSection(section);
            
            // Close mobile nav after selection
            if (window.innerWidth <= 768) {
                document.querySelector('.sidebar').classList.remove('active');
            }
        };

        const loadSection = (section) => {
            const contentArea = document.getElementById('contentArea');
            showLoading(true);

            setTimeout(() => {
                let content = '';
                switch (section) {
                    case 'dashboard':
                        content = loadDashboard();
                        break;
                    case 'rooms':
                        content = loadRooms();
                        break;
                    case 'subjects':
                        content = loadSubjects();
                        break;
                    case 'announcements':
                        content = loadAnnouncements();
                        break;
                    case 'messages':
                        content = loadMessages();
                        break;
                    case 'users':
                        content = loadUsers();
                        break;
                }
                contentArea.innerHTML = content;
                showLoading(false);
            }, 500);
        };

        // Section loaders
        const loadDashboard = () => {
            // Only show dashboard for admin and teachers
            if (currentUser.role === 'student') {
                return loadSubjects();
            }

            const totalRooms = appData.rooms.length;
            const totalSubjects = appData.subjects.length;
            const totalUsers = appData.users.length;
            const vacantRooms = appData.rooms.filter(room => room.status === 'Vacant').length;

            return `
                <div class="dashboard-grid grid-4">
                    <div class="stat-card">
                        <div class="stat-number">${totalRooms}</div>
                        <div class="stat-label">Total Classrooms</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">${totalSubjects}</div>
                        <div class="stat-label">Active Subjects</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">${totalUsers}</div>
                        <div class="stat-label">System Users</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">${vacantRooms}</div>
                        <div class="stat-label">Vacant Rooms</div>
                    </div>
                </div>

                <div class="dashboard-grid grid-2">
                    <div class="card">
                        <div class="card-header">
                            <h3>Recent Announcements</h3>
                        </div>
                        <div class="space-y-3">
                            ${appData.announcements.slice(0, 3).map(announcement => `
                                <div class="glass" style="padding: 1rem; border-radius: 10px;">
                                    <h4>${announcement.title}</h4>
                                    <p class="text-muted">${announcement.content}</p>
                                    <small class="text-muted">By ${announcement.author} • ${new Date(announcement.createdAt).toLocaleDateString()}</small>
                                </div>
                            `).join('')}
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <h3>Room Status Overview</h3>
                        </div>
                        <div class="space-y-3">
                            ${appData.rooms.slice(0, 4).map(room => `
                                <div class="flex justify-between items-center glass" style="padding: 1rem; border-radius: 10px;">
                                    <div>
                                        <strong>${room.name}</strong>
                                        <div class="text-muted">${room.type} • Capacity: ${room.capacity}</div>
                                        ${room.currentSubject ? `<div class="text-muted">Current Subject: ${room.currentSubject}</div>` : ''}
                                    </div>
                                    <div class="status-badge status-${room.status.toLowerCase().replace(' ', '-')}">${room.status}</div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                </div>
            `;
        };

        const loadRooms = () => {
            let filteredRooms = appData.rooms;
            if (searchQuery) {
                filteredRooms = appData.rooms.filter(room => 
                    room.name.toLowerCase().includes(searchQuery.toLowerCase()) ||
                    room.type.toLowerCase().includes(searchQuery.toLowerCase()) ||
                    room.status.toLowerCase().includes(searchQuery.toLowerCase()) ||
                    (room.currentSubject && room.currentSubject.toLowerCase().includes(searchQuery.toLowerCase()))
                );
            }

            // For students, only show rooms where they have subjects
            if (currentUser.role === 'student') {
                const studentSubjectIds = appData.subjects
                    .filter(subject => subject.enrolledStudents.includes(currentUser.id))
                    .map(subject => subject.id);
                
                filteredRooms = filteredRooms.filter(room => 
                    appData.subjects.some(subject => 
                        subject.room === room.name && studentSubjectIds.includes(subject.id)
                    )
                );
            }

            return `
                <div class="card">
                    <div class="card-header flex justify-between items-center">
                        <h3>Classroom Management</h3>
                        ${currentUser.role === 'admin' ? `
                        <button class="btn btn-primary" onclick="showModal('addRoomModal')">
                            <i class="fa fa-plus"></i> Add Classroom
                        </button>
                        ` : ''}
                    </div>
                    <div class="search-container">
                        <input type="text" class="search-input" id="roomSearch" placeholder="Search classrooms by name, type, or status..." value="${searchQuery}" oninput="handleSearch(event)">
                        <button class="btn btn-outline" onclick="clearSearch()">
                            <i class="fa fa-times"></i> Clear
                        </button>
                    </div>
                    <div class="rooms-grid">
                        ${filteredRooms.map(room => `
                            <div class="room-card ${room.status.toLowerCase().replace(' ', '-')}">
                                <div class="room-header">
                                    <div>
                                        <div class="room-name">${room.name}</div>
                                        <div class="text-muted">${room.type} • Capacity: ${room.capacity}</div>
                                        ${room.currentSubject ? `<div class="text-muted">Current Subject: ${room.currentSubject}</div>` : ''}
                                    </div>
                                    <div class="status-badge status-${room.status.toLowerCase().replace(' ', '-')}">${room.status}</div>
                                </div>
                                ${currentUser.role !== 'student' ? `
                                <div class="room-actions">
                                    <button class="action-badge edit" onclick="editRoom(${room.id})">
                                        <i class="fa fa-edit"></i> Edit
                                    </button>
                                    ${currentUser.role === 'admin' ? `
                                    <button class="action-badge delete" onclick="deleteRoom(${room.id})">
                                        <i class="fa fa-trash"></i> Delete
                                    </button>
                                    ` : ''}
                                </div>
                                ` : ''}
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
        };

        const loadSubjects = () => {
            let filteredSubjects = appData.subjects;
            if (searchQuery) {
                filteredSubjects = appData.subjects.filter(subject => 
                    subject.name.toLowerCase().includes(searchQuery.toLowerCase()) ||
                    subject.code.toLowerCase().includes(searchQuery.toLowerCase()) ||
                    subject.instructor.toLowerCase().includes(searchQuery.toLowerCase()) ||
                    subject.room.toLowerCase().includes(searchQuery.toLowerCase())
                );
            }

            // For students, only show enrolled subjects
            if (currentUser.role === 'student') {
                filteredSubjects = filteredSubjects.filter(subject => 
                    subject.enrolledStudents.includes(currentUser.id)
                );
            }

            return `
                <div class="card">
                    <div class="card-header flex justify-between items-center">
                        <h3>${currentUser.role === 'student' ? 'My Subjects' : 'Subject Management'}</h3>
                        <div class="flex gap-2">
                            ${currentUser.role === 'admin' ? `
                            <button class="btn btn-primary" onclick="showModal('addSubjectModal'); loadRoomsForSubject()">
                                <i class="fa fa-plus"></i> Add Subject
                            </button>
                            ` : ''}
                            ${currentUser.role === 'admin' || currentUser.role === 'teacher' ? `
                            <button class="btn btn-success" onclick="showModal('enrollStudentModal'); initializeEnrollModal()">
                                <i class="fa fa-user-plus"></i> Enroll Student
                            </button>
                            ` : ''}
                        </div>
                    </div>
                    <div class="search-container">
                        <input type="text" class="search-input" id="subjectSearch" placeholder="Search subjects by name, code, instructor, or room..." value="${searchQuery}" oninput="handleSearch(event)">
                        <button class="btn btn-outline" onclick="clearSearch()">
                            <i class="fa fa-times"></i> Clear
                        </button>
                    </div>
<div class="subjects-grid">
    ${filteredSubjects.map(subject => `
        <div class="subject-card">
            <div class="room-header">
                <div class="room-name">${subject.name}</div>
                <div class="status-badge" style="background: var(--primary-green); color: white;">${subject.code}</div>
            </div>
            <div class="space-y-2">
                <div><strong>Instructor:</strong> ${subject.instructor}</div>
                <div><strong>Schedule:</strong> ${subject.day}, ${subject.startTime} - ${subject.endTime}</div>
                <div><strong>Room:</strong> ${subject.room}</div>
                <div><strong>Units:</strong> ${subject.units}</div>
                ${currentUser.role !== 'student' ? `
                <div class="mt-2">
                    <strong>Enrolled Students (${subject.enrolledStudents.length}):</strong>
                </div>
                ` : ''}
            </div>
                                ${currentUser.role !== 'student' ? `
                                <div class="room-actions">
                                    <button class="action-badge edit" onclick="editSubject(${subject.id})">
                                        <i class="fa fa-edit"></i> Edit
                                    </button>
                                    ${currentUser.role === 'admin' ? `
                                    <button class="action-badge delete" onclick="deleteSubject(${subject.id})">
                                        <i class="fa fa-trash"></i> Delete
                                    </button>
                                    ` : ''}
                                </div>
                                ` : ''}
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
        };

        const loadAnnouncements = () => {
            return `
                <div class="card">
                    <div class="card-header flex justify-between items-center">
                        <h3>Announcements</h3>
                        ${currentUser.role === 'admin' || currentUser.role === 'teacher' ? `
                        <button class="btn btn-primary" onclick="showModal('addAnnouncementModal')">
                            <i class="fa fa-plus"></i> New Announcement
                        </button>
                        ` : ''}
                    </div>
                    <div class="space-y-4">
                        ${appData.announcements.map(announcement => `
                            <div class="glass" style="padding: 1.5rem; border-radius: 15px;">
                                <h4>${announcement.title}</h4>
                                <p class="text-muted mb-2">${announcement.content}</p>
                                <div class="flex justify-between items-center">
                                    <small class="text-muted">By ${announcement.author}</small>
                                    <small class="text-muted">${new Date(announcement.createdAt).toLocaleDateString()}</small>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
        };

        const loadMessages = () => {
            const userMessages = appData.messages.filter(msg => 
                msg.from === currentUser.id || msg.to === currentUser.id
            );

            return `
                <div class="card">
                    <div class="card-header flex justify-between items-center">
                        <h3>Messages</h3>
                        <button class="btn btn-primary" onclick="showModal('newMessageModal'); loadRecipients()">
                            <i class="fa fa-plus"></i> New Message
                        </button>
                    </div>
                    
                    <div class="message-thread">
                        ${userMessages.map(msg => {
                            const isSent = msg.from === currentUser.id;
                            const otherUser = appData.users.find(u => u.id === (isSent ? msg.to : msg.from));
                            return `
                                <div class="message ${isSent ? 'sent' : 'received'}">
                                    <div><strong>${isSent ? 'You' : otherUser.name}</strong></div>
                                    <div>${msg.content}</div>
                                    <small>${new Date(msg.timestamp).toLocaleString()}</small>
                                </div>
                            `;
                        }).join('')}
                    </div>

                    <div class="message-input">
                        <input type="text" class="form-input" id="quickMessage" placeholder="Type a quick message...">
                        <button class="btn btn-primary" onclick="sendQuickMessage()">
                            <i class="fa fa-paper-plane"></i> Send
                        </button>
                    </div>
                </div>
            `;
        };

        const loadUsers = () => {
            if (currentUser.role !== 'admin') return '<div class="card"><p>Access denied.</p></div>';

            let filteredUsers = appData.users;
            if (searchQuery) {
                filteredUsers = appData.users.filter(user => 
                    user.name.toLowerCase().includes(searchQuery.toLowerCase()) ||
                    user.email.toLowerCase().includes(searchQuery.toLowerCase()) ||
                    user.role.toLowerCase().includes(searchQuery.toLowerCase()) ||
                    (user.studentNumber && user.studentNumber.toLowerCase().includes(searchQuery.toLowerCase()))
                );
            }

            return `
                <div class="card">
                    <div class="card-header">
                        <h3>User Management</h3>
                    </div>
                    <div class="search-container">
                        <input type="text" class="search-input" id="userSearch" placeholder="Search users by name, email, role, or student number..." value="${searchQuery}" oninput="handleSearch(event)">
                        <button class="btn btn-outline" onclick="clearSearch()">
                            <i class="fa fa-times"></i> Clear
                        </button>
                    </div>
                    <div class="users-grid">
                        ${filteredUsers.map(user => `
                            <div class="user-card">
                                <div class="room-header">
                                    <div class="room-name">${user.name}</div>
                                    <div class="status-badge" style="background: ${user.role === 'admin' ? '#dc3545' : user.role === 'teacher' ? '#ffc107' : '#28a745'}; color: ${user.role === 'teacher' ? '#000' : 'white'};">${user.role}</div>
                                </div>
                                <div class="space-y-2">
                                    <div><strong>Email:</strong> ${user.email}</div>
                                    ${user.studentNumber ? `<div><strong>Student No:</strong> ${user.studentNumber}</div>` : ''}
                                    <div><strong>Contact:</strong> ${user.contactInfo}</div>
                                    <div><strong>Joined:</strong> ${new Date(user.createdAt).toLocaleDateString()}</div>
                                </div>
                                <div class="room-actions">
                                    <button class="action-badge edit" onclick="editUser(${user.id})">
                                        <i class="fa fa-edit"></i> Edit
                                    </button>
                                    ${user.id !== currentUser.id ? `
                                    <button class="action-badge delete" onclick="deleteUser(${user.id})">
                                        <i class="fa fa-trash"></i> Delete
                                    </button>
                                    ` : ''}
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
        };

        // Search functionality
        const handleSearch = (event) => {
            searchQuery = event.target.value;
            loadSection(currentSection);
        };

        const clearSearch = () => {
            searchQuery = '';
            loadSection(currentSection);
        };

        // Modal handlers
        const handleAddRoom = (event) => {
            event.preventDefault();
            const name = document.getElementById('roomName').value;
            const capacity = parseInt(document.getElementById('roomCapacity').value);
            const type = document.getElementById('roomType').value;

            const newRoom = {
                id: Math.max(...appData.rooms.map(r => r.id)) + 1,
                name,
                status: 'Vacant',
                capacity,
                type,
                currentSubject: null,
                updatedAt: new Date().toISOString()
            };

            appData.rooms.push(newRoom);
            saveData();
            closeModal('addRoomModal');
            showNotification('Classroom added successfully!', 'success');
            loadSection(currentSection);
        };

        const editRoom = (roomId) => {
            const room = appData.rooms.find(r => r.id === roomId);
            if (!room) return;

            document.getElementById('editRoomId').value = room.id;
            document.getElementById('editRoomName').value = room.name;
            document.getElementById('editRoomCapacity').value = room.capacity;
            document.getElementById('editRoomType').value = room.type;
            document.getElementById('editRoomStatus').value = room.status;

            // Load subjects for current subject selection
            const subjectSelect = document.getElementById('editRoomSubject');
            subjectSelect.innerHTML = '<option value="">No Subject</option>';
            appData.subjects.forEach(subject => {
                const option = document.createElement('option');
                option.value = subject.name;
                option.textContent = `${subject.name} (${subject.code})`;
                if (room.currentSubject === subject.name) {
                    option.selected = true;
                }
                subjectSelect.appendChild(option);
            });

            showModal('editRoomModal');
        };

        const handleEditRoom = (event) => {
            event.preventDefault();
            const roomId = parseInt(document.getElementById('editRoomId').value);
            const name = document.getElementById('editRoomName').value;
            const capacity = parseInt(document.getElementById('editRoomCapacity').value);
            const type = document.getElementById('editRoomType').value;
            const currentSubject = document.getElementById('editRoomSubject').value;
            const status = document.getElementById('editRoomStatus').value;

            const roomIndex = appData.rooms.findIndex(r => r.id === roomId);
            if (roomIndex !== -1) {
                appData.rooms[roomIndex] = {
                    ...appData.rooms[roomIndex],
                    name,
                    capacity,
                    type,
                    currentSubject,
                    status,
                    updatedAt: new Date().toISOString()
                };
                saveData();
                closeModal('editRoomModal');
                showNotification('Classroom updated successfully!', 'success');
                loadSection(currentSection);
            }
        };

        const deleteRoom = (roomId) => {
            if (confirm('Are you sure you want to delete this classroom?')) {
                appData.rooms = appData.rooms.filter(r => r.id !== roomId);
                saveData();
                showNotification('Classroom deleted successfully!', 'success');
                loadSection(currentSection);
            }
        };

        const loadRoomsForSubject = () => {
            const roomSelect = document.getElementById('subjectRoom');
            const editRoomSelect = document.getElementById('editSubjectRoom');
            
            roomSelect.innerHTML = '<option value="">Select Room</option>';
            editRoomSelect.innerHTML = '<option value="">Select Room</option>';
            
            appData.rooms.forEach(room => {
                const option = document.createElement('option');
                option.value = room.name;
                option.textContent = `${room.name} (${room.type})`;
                roomSelect.appendChild(option);
                
                const editOption = document.createElement('option');
                editOption.value = room.name;
                editOption.textContent = `${room.name} (${room.type})`;
                editRoomSelect.appendChild(editOption);
            });
        };

        const handleAddSubject = (event) => {
            event.preventDefault();
            const name = document.getElementById('subjectName').value;
            const code = document.getElementById('subjectCode').value;
            const units = parseFloat(document.getElementById('subjectUnits').value);
            const day = document.getElementById('subjectDay').value;
            const startTime = document.getElementById('subjectStartTime').value;
            const endTime = document.getElementById('subjectEndTime').value;
            const instructor = document.getElementById('subjectInstructor').value;
            const room = document.getElementById('subjectRoom').value;

            const newSubject = {
                id: Math.max(...appData.subjects.map(s => s.id)) + 1,
                name,
                code,
                units,
                day,
                startTime,
                endTime,
                room,
                instructor,
                enrolledStudents: []
            };

            appData.subjects.push(newSubject);
            saveData();
            closeModal('addSubjectModal');
            showNotification('Subject added successfully!', 'success');
            loadSection(currentSection);
        };

        const editSubject = (subjectId) => {
            const subject = appData.subjects.find(s => s.id === subjectId);
            if (!subject) return;

            document.getElementById('editSubjectId').value = subject.id;
            document.getElementById('editSubjectName').value = subject.name;
            document.getElementById('editSubjectCode').value = subject.code;
            document.getElementById('editSubjectUnits').value = subject.units;
            document.getElementById('editSubjectDay').value = subject.day;
            document.getElementById('editSubjectStartTime').value = subject.startTime;
            document.getElementById('editSubjectEndTime').value = subject.endTime;
            document.getElementById('editSubjectInstructor').value = subject.instructor;
            
            // Load rooms for selection
            loadRoomsForSubject();
            document.getElementById('editSubjectRoom').value = subject.room;

            showModal('editSubjectModal');
        };

        const handleEditSubject = (event) => {
            event.preventDefault();
            const subjectId = parseInt(document.getElementById('editSubjectId').value);
            const name = document.getElementById('editSubjectName').value;
            const code = document.getElementById('editSubjectCode').value;
            const units = parseFloat(document.getElementById('editSubjectUnits').value);
            const day = document.getElementById('editSubjectDay').value;
            const startTime = document.getElementById('editSubjectStartTime').value;
            const endTime = document.getElementById('editSubjectEndTime').value;
            const instructor = document.getElementById('editSubjectInstructor').value;
            const room = document.getElementById('editSubjectRoom').value;

            const subjectIndex = appData.subjects.findIndex(s => s.id === subjectId);
            if (subjectIndex !== -1) {
                appData.subjects[subjectIndex] = {
                    ...appData.subjects[subjectIndex],
                    name,
                    code,
                    units,
                    day,
                    startTime,
                    endTime,
                    instructor,
                    room
                };
                saveData();
                closeModal('editSubjectModal');
                showNotification('Subject updated successfully!', 'success');
                loadSection(currentSection);
            }
        };

        const deleteSubject = (subjectId) => {
            if (confirm('Are you sure you want to delete this subject?')) {
                appData.subjects = appData.subjects.filter(s => s.id !== subjectId);
                saveData();
                showNotification('Subject deleted successfully!', 'success');
                loadSection(currentSection);
            }
        };

        const handleAddAnnouncement = (event) => {
            event.preventDefault();
            const title = document.getElementById('announcementTitle').value;
            const content = document.getElementById('announcementContent').value;

            const newAnnouncement = {
                id: Math.max(...appData.announcements.map(a => a.id)) + 1,
                title,
                content,
                author: currentUser.name,
                createdAt: new Date().toISOString()
            };

            appData.announcements.unshift(newAnnouncement);
            saveData();
            closeModal('addAnnouncementModal');
            showNotification('Announcement posted successfully!', 'success');
            loadSection(currentSection);
        };

        const loadRecipients = () => {
            const select = document.getElementById('messageRecipient');
            select.innerHTML = '<option value="">Select recipient</option>';
            
            appData.users
                .filter(user => user.id !== currentUser.id)
                .forEach(user => {
                    const option = document.createElement('option');
                    option.value = user.id;
                    option.textContent = `${user.name} (${user.role})`;
                    select.appendChild(option);
                });
        };

        const handleNewMessage = (event) => {
            event.preventDefault();
            const recipientId = parseInt(document.getElementById('messageRecipient').value);
            const content = document.getElementById('messageContent').value;

            const newMessage = {
                id: Math.max(...appData.messages.map(m => m.id)) + 1,
                from: currentUser.id,
                to: recipientId,
                content,
                timestamp: new Date().toISOString(),
                read: false
            };

            appData.messages.push(newMessage);
            saveData();
            closeModal('newMessageModal');
            showNotification('Message sent successfully!', 'success');
            loadSection('messages');
        };

        const initializeEnrollModal = () => {
            const studentSelect = document.getElementById('enrollStudent');
            const subjectSelect = document.getElementById('enrollSubject');

            studentSelect.innerHTML = '<option value="">Select student</option>';
            subjectSelect.innerHTML = '<option value="">Select subject</option>';

            appData.users
                .filter(user => user.role === 'student')
                .forEach(student => {
                    const option = document.createElement('option');
                    option.value = student.id;
                    option.textContent = `${student.name} (${student.studentNumber})`;
                    studentSelect.appendChild(option);
                });

            appData.subjects.forEach(subject => {
                const option = document.createElement('option');
                option.value = subject.id;
                option.textContent = `${subject.name} (${subject.code})`;
                subjectSelect.appendChild(option);
            });
        };

        const handleEnrollStudent = (event) => {
            event.preventDefault();
            const studentId = parseInt(document.getElementById('enrollStudent').value);
            const subjectId = parseInt(document.getElementById('enrollSubject').value);

            // Add student to subject's enrolled students
            const subject = appData.subjects.find(s => s.id === subjectId);
            if (subject && !subject.enrolledStudents.includes(studentId)) {
                subject.enrolledStudents.push(studentId);
            }

            saveData();
            closeModal('enrollStudentModal');
            showNotification('Student enrolled successfully!', 'success');
            loadSection(currentSection);
        };

        // User management functions
        const editUser = (userId) => {
            const user = appData.users.find(u => u.id === userId);
            if (!user) return;

            document.getElementById('editUserId').value = user.id;
            document.getElementById('editUserName').value = user.name;
            document.getElementById('editUserEmail').value = user.email;
            document.getElementById('editUserStudentNumber').value = user.studentNumber || '';
            document.getElementById('editUserContact').value = user.contactInfo;
            document.getElementById('editUserRole').value = user.role;

            showModal('editUserModal');
        };

        const handleEditUser = (event) => {
            event.preventDefault();
            const userId = parseInt(document.getElementById('editUserId').value);
            const name = document.getElementById('editUserName').value;
            const email = document.getElementById('editUserEmail').value;
            const studentNumber = document.getElementById('editUserStudentNumber').value;
            const contact = document.getElementById('editUserContact').value;
            const role = document.getElementById('editUserRole').value;

            const userIndex = appData.users.findIndex(u => u.id === userId);
            if (userIndex !== -1) {
                appData.users[userIndex] = {
                    ...appData.users[userIndex],
                    name,
                    email,
                    studentNumber,
                    contactInfo: contact,
                    role
                };
                saveData();
                closeModal('editUserModal');
                showNotification('User updated successfully!', 'success');
                loadSection(currentSection);
            }
        };

        const deleteUser = (userId) => {
            if (confirm('Are you sure you want to delete this user?')) {
                appData.users = appData.users.filter(u => u.id !== userId);
                saveData();
                showNotification('User deleted successfully!', 'success');
                loadSection(currentSection);
            }
        };

        // Student-specific functions
        const viewSubjectDetails = (subjectId) => {
            const subject = appData.subjects.find(s => s.id === subjectId);
            if (!subject) return;
            
            alert(`Subject Details:\n\nName: ${subject.name}\nCode: ${subject.code}\nInstructor: ${subject.instructor}\nSchedule: ${subject.day}, ${subject.startTime} - ${subject.endTime}\nRoom: ${subject.room}\nUnits: ${subject.units}`);
        };

        const unenrollFromSubject = (subjectId) => {
            if (confirm('Are you sure you want to unenroll from this subject?')) {
                const subject = appData.subjects.find(s => s.id === subjectId);
                if (subject) {
                    subject.enrolledStudents = subject.enrolledStudents.filter(id => id !== currentUser.id);
                    saveData();
                    showNotification('Successfully unenrolled from subject', 'success');
                    loadSection(currentSection);
                }
            }
        };

        // Quick message function
        const sendQuickMessage = () => {
            const input = document.getElementById('quickMessage');
            const content = input.value.trim();
            
            if (!content) return;

            // For demo, send to first available user
            const recipient = appData.users.find(u => u.id !== currentUser.id);
            if (!recipient) return;

            const newMessage = {
                id: Math.max(...appData.messages.map(m => m.id)) + 1,
                from: currentUser.id,
                to: recipient.id,
                content,
                timestamp: new Date().toISOString(),
                read: false
            };

            appData.messages.push(newMessage);
            saveData();
            input.value = '';
            showNotification('Message sent!', 'success');
            loadSection('messages');
        };

        // Logout function
        const logout = () => {
            currentUser = null;
            localStorage.removeItem('currentUser');
            document.getElementById('app').classList.add('hidden');
            document.getElementById('loginScreen').classList.remove('hidden');
            
            // Reset forms
            document.getElementById('loginForm').reset();
            document.getElementById('registerForm').reset();
            showAuthForm('login');
        };

        // Initialize the application
        document.addEventListener('DOMContentLoaded', () => {
            // Check if user is already logged in
            const savedUser = localStorage.getItem('currentUser');
            if (savedUser) {
                currentUser = JSON.parse(savedUser);
                document.getElementById('loginScreen').classList.add('hidden');
                document.getElementById('app').classList.remove('hidden');
                loadApp();
            }
        });
    </script>
</body>
</html>